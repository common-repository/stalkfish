"use strict";!function(a,c){a(function(){var s=c.i18n.__;a("#sf-mock-data").on("click",function(e){e.preventDefault&&e.preventDefault();var e=a("#sf_app_api_key").val(),t=a(this),i=s("Sending","stalkfish");return t.val(i),c.ajax.post("mock_log_request",{key:e}).done(function(){i=s("Sent","ang"),t.val(i),t.attr("disabled","disabled"),setTimeout(function(){t.removeAttr("disabled"),t.val(s("Send Sample Data","stalkfish"))},3e3)}).fail(function(){i=s("Failed","stalkfish"),t.val(i),setTimeout(function(){t.val(s("Send Sample Data","stalkfish"))},2e3)}),!1});function t(e){var i;a("select.select2-select.pipe_or_context",e).each(function(e,t){a(t).select2({allowClear:!0,templateResult:function(e){return void 0===e.id?e.text:-1===e.id.indexOf("-")?a('<span class="parent">'+e.text+"</span>"):a('<span class="child">'+e.text+"</span>")},matcher:function(e,t){var i=a.extend(!0,{},t);if(null===e.term||""===a.trim(e.term))return i;var s=e.term.toLowerCase();if(0<=i.id.toLowerCase().indexOf(s))return i;if(i.children){for(var l=i.children.length-1;0<=l;l--)-1===i.children[l].id.toLowerCase().indexOf(s)&&i.children.splice(l,1);if(0<i.children.length)return i}return null}}).on("change",function(){var e=a(this).closest("tr"),t=a(this).val();!function(e,t){var n=a(".select2-select.action",e),c=n.val();n.empty(),n.prop("disabled",!0);e=a("<option/>",{value:"",text:""});n.append(e);t={action:"sf_get_actions",pipe:t};a.post(window.ajaxurl,t,function(e){var t,i=e.success,s=e.data;if(i){for(var l in s)s.hasOwnProperty(l)&&(t=s[l],t=a("<option/>",{value:l,text:t}),n.append(t));n.val(c),n.prop("disabled",!1),a(document).trigger("alert-actions-updated")}})}(e,t=t&&0<t.indexOf("-")?t.split("-")[0]:t)})}),a("select.select2-select.action",e).each(function(e,t){a(t).select2({allowClear:!0})}),a("select.select2-select.author_or_role",e).each(function(e,t){(i=a(t)).select2({ajax:{type:"POST",url:ajaxurl,dataType:"json",quietMillis:500,data:function(e,t){return{find:e,limit:10,pager:t,action:"sf_get_users",nonce:i.data("nonce")}},processResults:function(e){var t={results:[{text:"",id:""},{text:"Roles",children:[]},{text:"Users",children:[]}]};if(!0!==e.success||void 0===e.data||!0!==e.data.status)return t;if(void 0===e.data.users||void 0===e.data.roles)return t;var i=[];return a.each(e.data.roles,function(e,t){i.push({id:e,text:t})}),t.results[1].children=i,t.results[2].children=e.data.users,t}},templateResult:function(e){var t=a("<div>").text(e.text);return void 0!==e.icon&&e.icon&&(t.prepend(a('<img src="'+e.icon+'" class="sf-select2-icon">')),t.attr("title",e.tooltip)),void 0!==e.tooltip?t.attr("title",e.tooltip):void 0!==e.user_count&&t.attr("title",e.user_count),t},templateSelection:function(e){var t=a("<div>").text(e.text);return a.isNumeric(e.id)&&e.text.indexOf("icon-users")<0&&t.append(a('<i class="icon16 icon-users"></i>')),t},allowClear:!0,placeholder:i.data("placeholder")}).on("change",function(){var e=a(this).select2("data");a(this).data("selected-id",e.id),a(this).data("selected-text",e.text)})}),a(".exclude_rules_remove_rule_row",e).on("click",function(e){a(this).closest("tr").remove(),n(),l(),e.preventDefault()})}var e=a(".sf-exclude-list tbody tr:not(.hidden)"),i=a(".sf-exclude-list tr.helper");function l(){var e=a("table.sf-exclude-list tbody tr:not( .hidden ) input.cb-select:checked"),t=a("#exclude_remove_rules");0===e.length?t.prop("disabled",!0):t.prop("disabled",!1)}function n(){var e=a("table.sf-exclude-list tbody tr:not( .hidden )"),t=a("table.sf-exclude-list tbody tr.no-items"),i=a(".check-column.manage-column input.cb-select"),s=a("#exclude_remove_rules");0===e.length?(t.show(),i.prop("disabled",!0),s.prop("disabled",!0)):(t.hide(),i.prop("disabled",!1)),(e=e).length&&(e.removeClass("alternate"),e.each(function(e){a(this).addClass(e%2?"":"alternate")}))}t(e),a("select.select2-select.author_or_role",e).each(function(){var e=a("<option selected>"+a(this).data("selected-text")+"</option>").val(a(this).data("selected-id"));a(this).append(e).trigger("change")}),a("select.select2-select.pipe_or_context",e).each(function(){var e=[a(this).siblings(".pipe").val(),a(this).siblings(".context").val()];""===e[1]&&e.splice(1,1),a(this).val(e.join("-")).trigger("change")}),a("#exclude_new_rule").on("click",function(){var e=i.clone();e.removeAttr("class"),e.insertBefore(i),t(e),n(),l()}),a("#exclude_remove_rules").on("click",function(){var e=a("table.sf-exclude-list"),t=a("tbody input.cb-select:checked",e).closest("tr");2<=a("tbody tr",e).length-t.length?t.remove():(a(":input",t).val(""),a(t).not(":first").remove(),a(".select2-select",t).select2("val","")),e.find("input.cb-select").prop("checked",!1),n(),l()}),a(".sf-exclude-list").closest("form").submit(function(){a(".sf-exclude-list tbody tr.hidden",this).each(function(){a(this).find(":input").removeAttr("name")}),a(".sf-exclude-list tbody tr:not(.hidden) select.select2-select.pipe_or_context",this).each(function(){var e=a(this).val().split("-");a(this).siblings(".pipe").val(e[0]),a(this).siblings(".context").val(e.slice(1).join("-")),a(this).removeAttr("name")}),a(".sf-exclude-list tbody tr:not(.hidden) select.select2-select.ip_address",this).each(function(){var e=a("option:selected",this).first();e.length||a(this).append('<option selected="selected"></option>'),a("option:selected:not(:first)",this).each(function(){e.attr("value",e.attr("value")+","+a(this).attr("value")),a(this).removeAttr("selected")})})}),a(".sf-exclude-list").closest("td").prev("th").hide(),a("table.sf-exclude-list").on("click","input.cb-select",function(){l()}),a(document).ready(function(){n(),l()})})}(jQuery,wp);